dist: focal
notifications:
  email:
    on_success: change
    on_failure: always
matrix:
  include:
    - language: minimal
      name: "Noetic Robot Setup Script"
      cache:
        directories:
          - ~/.npm
          - ~/.cache
      script:
        - ${TRAVIS_BUILD_DIR}/setup-noetic.sh

    - language: node_js
      name: "Node Script Test and Code Coverage"
      node_js: "lts/*"
      cache:
        directories:
          - ~/.npm
          - ~/.cache
      before_install:
        - mkdir -p ~/.arlobot/rosmaps ~/catkin_ws/src
        - touch ~/.arlobot/rosmaps/dummymap.data ~/.arlobot/rosmaps/dummymap.posegraph
        - cp scripts/dotarlobot/personalDataForBehavior.json ~/.arlobot/
        - ln -s ${TRAVIS_BUILD_DIR} ~/catkin_ws/src/ArloBot
        - cd node
      install:
        - npm install -g nyc codecov
      script:
        - npm ci
        - nyc ./node_modules/jest/bin/jest.js --forceExit
        - nyc report --reporter=text-lcov > coverage.lcov
        - codecov

    - language: node_js
      name: "React Website"
      node_js: "lts/*"
      cache:
        directories:
          - ~/.npm
          - ~/.cache
      before_install:
        - cd website
      script:
        - npm test
        - npm run build
